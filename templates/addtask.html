<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Support Dashboard | Add New Task</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Include jQuery (from CDN) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Your other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>  <!-- Required for Bootstrap -->
</head>
<body>
    <div class="header">
        <img src="{{ url_for('static', filename='images/oryo_logo.png') }}" alt="Logo" class="logo">
    </div>
    <h1>Support Dashboard</h1>

          <!-- Go back to Support Button -->
    <!-- Add Task Button -->
    <form action="{{ url_for('support.support') }}">
        <button type="submit">Go Back</button>
    </form>
    <!-- Flash Message -->
    <div id="message" class="mt-3 text-center"></div>

    <h2 class="mb-4 text-center">Add New Installation Task</h2>

    <!-- Add New Installation form -->
    <div class="card p-4 shadow">
        <form id="taskForm">
            <div class="mb-3">
                <label for="project_id" class="form-label">Project</label>
                <select name="project_id" id="project_id" class="form-select" required>
                    <option value="">Select Project</option>
                    {% for project in projects %}
                        <option value="{{ project.project_id }}">{{ project.project_description }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="client_id" class="form-label">Client</label>
                <select name="client_id" id="client_id" class="form-select" required>
                    <option value="">Select Client</option>
                    {% for client in clients %}
                        <option value="{{ client.customer_id }}">{{ client.customer_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="technician_user_id" class="form-label">Assign Technician</label>
                <select name="technician_user_id" id="technician_user_id" class="form-select" required>
                    <option value="">Select Technician</option>
                    {% for user in users %}
                        <option value="{{ user.user_id }}">{{ user.f_name }} {{ user.l_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="product_id" class="form-label">Product Type</label>
                <select name="product_id" id="product_id" class="form-select" required>
                    <option value="">Select Product</option>
                    {% for product in products %}
                        <option value="{{ product.product_id }}">{{ product.product_description}}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Dynamic Fields Container -->
            <div id="dynamicFields"></div>

            <button type="submit" class="btn btn-primary w-100">Create Task</button>
        </form>
    </div>

    
    <!-- Modal Overlay for updating Task-->
    <div class="modal fade" id="editTask" tabindex="-1" aria-labelledby="editTaskLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editTaskLabel"> *make this dynamic* e.g ProductType: Device Imei</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div id="editTaskMessage"> </div>
                </div>
                <div class="modal-body">
                    <form id="installation_Update_Form">
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Product Description</label>
                            <input type="text" class="form-control" id="productDescription" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="deviceImei" class="form-label">Device Imei</label>
                            <input type="text" class="form-control" id="deviceImei" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="technician" class="form-label">Assigned Technician</label>
                            <input type="text" class="form-control" id="technician" readonly>
                        </div>

                        <div id="dynamicFields_tabletest"></div>
                        <!-- Add other fields as needed -->
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" id="saveChanges">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>



    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <!-- Your other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>  <!-- Required for Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>  <!-- Bootstrap JS -->
</body>
</html>